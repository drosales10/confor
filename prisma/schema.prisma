// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserStatus {
  ACTIVE
  INACTIVE
  PENDING_VERIFICATION
  LOCKED
  DELETED
}

enum AuthProvider {
  LOCAL
  GOOGLE
  GITHUB
  MICROSOFT
}

enum PermissionAction {
  CREATE
  READ
  UPDATE
  DELETE
  EXPORT
  ADMIN
}

enum NotificationChannel {
  EMAIL
  IN_APP
  SMS
  PUSH
}

enum NotificationStatus {
  PENDING
  SENT
  DELIVERED
  READ
  FAILED
}

enum AuditAction {
  CREATE
  UPDATE
  DELETE
  LOGIN
  LOGOUT
  LOGIN_FAILED
  PASSWORD_RESET
  PERMISSION_CHANGE
  EXPORT
  VIEW
}

enum ConfigType {
  STRING
  INTEGER
  BOOLEAN
  JSON
  SECRET
}

enum PatrimonyLevel2Type {
  FINCA
  PREDIO
  HATO
  FUNDO
  HACIENDA
}

enum LegalStatus {
  ADQUISICION
  ARRIENDO
  USUFRUCTO
  COMODATO
}

enum PatrimonyLevel3Type {
  COMPARTIMIENTO
  BLOCK
  SECCION
  LOTE
  ZONA
  BLOQUE
}

enum PatrimonyLevel4Type {
  RODAL
  PARCELA
  ENUMERATION
  UNIDAD_DE_MANEJO
}

enum PatrimonyLevel5Type {
  REFERENCIA
  SUBUNIDAD
  SUBPARCELA
  MUESTRA
  SUBMUESTRA
}

enum PlotShapeType {
  RECTANGULAR
  CUADRADA
  CIRCULAR
  HEXAGONAL
}

enum BiologicalAssetType {
  COMERCIAL
  INVESTIGACION

  @@map("biological_asset_type")
}

enum ImaClassification {
  I
  II
  III
  IV
  V
}

enum VegetalMaterialType {
  PURA
  HIBRIDA
}

enum PlantType {
  PROGENIE
  CLON
  INJERTO
  IN_VITRO
}

enum PlantOrigin {
  NATIVA
  EXOTICA
  NATURALIZADA
  INTRODUCIDA
  ENDEMICA
  CULTIVADA
}

enum CommunityType {
  COMUNA
  TERRITORIO_INDIGENA
  COMUNIDAD_CRIOLLA
  PARROQUIA
}

enum RecommendedHarvestType {
  MECANIZADA
  MANUAL
}

model Organization {
  id                         String                       @id @default(uuid()) @db.Uuid
  name                       String                       @db.VarChar(255)
  slug                       String                       @unique @db.VarChar(100)
  description                String?
  logoUrl                    String?                      @db.VarChar(500)
  countryId                  String?                      @db.Uuid
  website                    String?                      @db.VarChar(255)
  isActive                   Boolean                      @default(true)
  settings                   Json?
  country                    Country?                     @relation(fields: [countryId], references: [id])
  createdAt                  DateTime                     @default(now())
  updatedAt                  DateTime                     @updatedAt
  deletedAt                  DateTime?
  roles                      Role[]
  users                      User[]
  systemConfigurations       SystemConfiguration[]
  auditLogs                  AuditLog[]
  fileUploads                FileUpload[]
  forestPatrimonyLevel2Units ForestPatrimonyLevel2[]
  managementSchemes          ManagementScheme[]
  inventoryTypes             ForestInventoryTypeCatalog[]
  imaClasses                 ImaClass[]
  species                    Species[]
  provenances                Provenance[]
  vegetalMaterials           VegetalMaterial[]
  landUseTypes               LandUseType[]
  spacings                   Spacing[]
  productTypes               ProductType[]
}

model Role {
  id              String           @id @default(uuid()) @db.Uuid
  organizationId  String?          @db.Uuid
  name            String           @db.VarChar(100)
  slug            String           @db.VarChar(100)
  description     String?
  isSystemRole    Boolean          @default(false)
  isActive        Boolean          @default(true)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  organization    Organization?    @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  rolePermissions RolePermission[]
  userRoles       UserRole[]

  @@unique([organizationId, slug])
}

model Module {
  id           String       @id @default(uuid()) @db.Uuid
  name         String       @unique @db.VarChar(100)
  slug         String       @unique @db.VarChar(100)
  description  String?
  icon         String?      @db.VarChar(100)
  routePath    String?      @db.VarChar(255)
  isActive     Boolean      @default(true)
  displayOrder Int          @default(0)
  parentId     String?      @db.Uuid
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  parent       Module?      @relation("ModuleHierarchy", fields: [parentId], references: [id])
  children     Module[]     @relation("ModuleHierarchy")
  permissions  Permission[]
}

model Permission {
  id              String           @id @default(uuid()) @db.Uuid
  moduleId        String           @db.Uuid
  action          PermissionAction
  name            String           @db.VarChar(150)
  description     String?
  createdAt       DateTime         @default(now())
  module          Module           @relation(fields: [moduleId], references: [id], onDelete: Cascade)
  rolePermissions RolePermission[]

  @@unique([moduleId, action])
}

model RolePermission {
  id           String     @id @default(uuid()) @db.Uuid
  roleId       String     @db.Uuid
  permissionId String     @db.Uuid
  grantedAt    DateTime   @default(now())
  grantedBy    String?    @db.Uuid
  role         Role       @relation(fields: [roleId], references: [id], onDelete: Cascade)
  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)

  @@unique([roleId, permissionId])
}

model User {
  id                     String                   @id @default(uuid()) @db.Uuid
  organizationId         String?                  @db.Uuid
  email                  String                   @unique @db.VarChar(255)
  emailVerifiedAt        DateTime?
  username               String?                  @unique @db.VarChar(100)
  passwordHash           String?                  @db.VarChar(255)
  authProvider           AuthProvider             @default(LOCAL)
  providerId             String?                  @db.VarChar(255)
  status                 UserStatus               @default(PENDING_VERIFICATION)
  firstName              String?                  @db.VarChar(100)
  lastName               String?                  @db.VarChar(100)
  displayName            String?                  @db.VarChar(200)
  avatarUrl              String?                  @db.VarChar(500)
  phone                  String?                  @db.VarChar(20)
  phoneVerifiedAt        DateTime?
  timezone               String?                  @default("UTC") @db.VarChar(50)
  locale                 String?                  @default("en") @db.VarChar(10)
  lastLoginAt            DateTime?
  lastLoginIp            String?                  @db.VarChar(45)
  failedLoginAttempts    Int                      @default(0)
  lockedUntil            DateTime?
  mfaEnabled             Boolean                  @default(false)
  mfaSecret              String?                  @db.VarChar(255)
  mfaBackupCodes         String[]
  metadata               Json?
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime                 @updatedAt
  deletedAt              DateTime?
  organization           Organization?            @relation(fields: [organizationId], references: [id], onDelete: SetNull)
  userRoles              UserRole[]
  sessions               Session[]
  passwordResetTokens    PasswordResetToken[]
  emailVerificationToken EmailVerificationToken[]
  profile                UserProfile?
  notifications          Notification[]
  notificationPrefs      NotificationPreference[]
  auditLogs              AuditLog[]
  dashboardLayouts       UserDashboardLayout[]
  fileUploads            FileUpload[]
}

model UserRole {
  id         String    @id @default(uuid()) @db.Uuid
  userId     String    @db.Uuid
  roleId     String    @db.Uuid
  assignedAt DateTime  @default(now())
  assignedBy String?   @db.Uuid
  expiresAt  DateTime?
  isActive   Boolean   @default(true)
  user       User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  role       Role      @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([userId, roleId])
}

model Session {
  id           String     @id @default(uuid()) @db.Uuid
  userId       String     @db.Uuid
  tokenHash    String     @unique @db.VarChar(255)
  refreshToken String?    @unique @db.VarChar(255)
  ipAddress    String?    @db.VarChar(45)
  userAgent    String?
  deviceInfo   Json?
  isActive     Boolean    @default(true)
  expiresAt    DateTime
  lastActivity DateTime   @default(now())
  createdAt    DateTime   @default(now())
  revokedAt    DateTime?
  user         User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  auditLogs    AuditLog[]
}

model PasswordResetToken {
  id        String    @id @default(uuid()) @db.Uuid
  userId    String    @db.Uuid
  tokenHash String    @unique @db.VarChar(255)
  expiresAt DateTime
  usedAt    DateTime?
  createdAt DateTime  @default(now())
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model EmailVerificationToken {
  id         String    @id @default(uuid()) @db.Uuid
  userId     String    @db.Uuid
  email      String    @db.VarChar(255)
  tokenHash  String    @unique @db.VarChar(255)
  expiresAt  DateTime
  verifiedAt DateTime?
  createdAt  DateTime  @default(now())
  user       User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model UserProfile {
  id           String   @id @default(uuid()) @db.Uuid
  userId       String   @unique @db.Uuid
  bio          String?
  jobTitle     String?  @db.VarChar(150)
  department   String?  @db.VarChar(150)
  company      String?  @db.VarChar(150)
  addressLine1 String?  @db.VarChar(255)
  addressLine2 String?  @db.VarChar(255)
  city         String?  @db.VarChar(100)
  state        String?  @db.VarChar(100)
  postalCode   String?  @db.VarChar(20)
  country      String?  @db.VarChar(100)
  socialLinks  Json?
  preferences  Json?
  customFields Json?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Notification {
  id           String              @id @default(uuid()) @db.Uuid
  userId       String              @db.Uuid
  title        String              @db.VarChar(255)
  body         String
  type         String              @db.VarChar(100)
  channel      NotificationChannel @default(IN_APP)
  status       NotificationStatus  @default(PENDING)
  data         Json?
  actionUrl    String?             @db.VarChar(500)
  readAt       DateTime?
  sentAt       DateTime?
  scheduledFor DateTime?
  expiresAt    DateTime?
  createdAt    DateTime            @default(now())
  user         User                @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model NotificationPreference {
  id               String              @id @default(uuid()) @db.Uuid
  userId           String              @db.Uuid
  notificationType String              @db.VarChar(100)
  channel          NotificationChannel
  isEnabled        Boolean             @default(true)
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt
  user             User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, notificationType, channel])
}

model SystemConfiguration {
  id              String        @id @default(uuid()) @db.Uuid
  organizationId  String?       @db.Uuid
  category        String        @db.VarChar(100)
  key             String        @db.VarChar(150)
  value           String?
  configType      ConfigType    @default(STRING)
  description     String?
  isPublic        Boolean       @default(false)
  isEditable      Boolean       @default(true)
  validationRules Json?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  updatedBy       String?       @db.Uuid
  organization    Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([organizationId, category, key])
}

model AuditLog {
  id             String        @id @default(uuid()) @db.Uuid
  organizationId String?       @db.Uuid
  userId         String?       @db.Uuid
  sessionId      String?       @db.Uuid
  action         AuditAction
  entityType     String?       @db.VarChar(100)
  entityId       String?       @db.Uuid
  entityName     String?       @db.VarChar(255)
  oldValues      Json?
  newValues      Json?
  changedFields  String[]
  ipAddress      String?       @db.VarChar(45)
  userAgent      String?
  requestId      String?       @db.Uuid
  durationMs     Int?
  statusCode     Int?
  errorMessage   String?
  metadata       Json?
  createdAt      DateTime      @default(now())
  organization   Organization? @relation(fields: [organizationId], references: [id])
  user           User?         @relation(fields: [userId], references: [id], onDelete: SetNull)
  session        Session?      @relation(fields: [sessionId], references: [id], onDelete: SetNull)
}

model DashboardWidget {
  id                  String                @id @default(uuid()) @db.Uuid
  name                String                @db.VarChar(150)
  slug                String                @unique @db.VarChar(150)
  description         String?
  componentName       String                @db.VarChar(150)
  defaultConfig       Json?
  requiredPermissions String[]
  isActive            Boolean               @default(true)
  createdAt           DateTime              @default(now())
  userLayouts         UserDashboardLayout[]
}

model UserDashboardLayout {
  id        String          @id @default(uuid()) @db.Uuid
  userId    String          @db.Uuid
  widgetId  String          @db.Uuid
  positionX Int             @default(0)
  positionY Int             @default(0)
  width     Int             @default(4)
  height    Int             @default(3)
  config    Json?
  isVisible Boolean         @default(true)
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt
  user      User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  widget    DashboardWidget @relation(fields: [widgetId], references: [id])

  @@unique([userId, widgetId])
}

model FileUpload {
  id             String        @id @default(uuid()) @db.Uuid
  userId         String?       @db.Uuid
  organizationId String?       @db.Uuid
  originalName   String        @db.VarChar(255)
  storedName     String        @db.VarChar(255)
  filePath       String        @db.VarChar(500)
  fileUrl        String?       @db.VarChar(500)
  mimeType       String?       @db.VarChar(100)
  fileSize       BigInt?
  checksum       String?       @db.VarChar(64)
  entityType     String?       @db.VarChar(100)
  entityId       String?       @db.Uuid
  isPublic       Boolean       @default(false)
  metadata       Json?
  createdAt      DateTime      @default(now())
  deletedAt      DateTime?
  user           User?         @relation(fields: [userId], references: [id], onDelete: SetNull)
  organization   Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)
}

model ForestPatrimonyLevel2 {
  id                   String                    @id @default(uuid()) @db.Uuid
  organizationId       String?                   @db.Uuid
  code                 String                    @unique @db.VarChar(80)
  name                 String                    @db.VarChar(255)
  type                 PatrimonyLevel2Type
  legalDocumentDate    DateTime?
  legalStatus          LegalStatus?
  totalAreaHa          Decimal                   @db.Decimal(12, 2)
  centroidLatitude     Decimal?                  @db.Decimal(10, 7)
  centroidLongitude    Decimal?                  @db.Decimal(10, 7)
  ownerRepresentative  String?                   @db.VarChar(255)
  publicRegistryNumber String?                   @db.VarChar(120)
  publicRegistryDate   DateTime?
  address              String?
  lastInfoDate         DateTime?
  isActive             Boolean                   @default(true)
  createdAt            DateTime                  @default(now())
  updatedAt            DateTime                  @updatedAt
  organization         Organization?             @relation(fields: [organizationId], references: [id], onDelete: Restrict)
  neighbors            ForestPatrimonyNeighbor[]
  level3Units          ForestPatrimonyLevel3[]

  @@index([organizationId])
}

model ForestPatrimonyNeighbor {
  id        String                @id @default(uuid()) @db.Uuid
  level2Id  String                @db.Uuid
  code      String                @db.VarChar(80)
  name      String                @db.VarChar(255)
  type      String                @db.VarChar(80)
  createdAt DateTime              @default(now())
  level2    ForestPatrimonyLevel2 @relation(fields: [level2Id], references: [id], onDelete: Cascade)

  @@unique([level2Id, code])
}

model ForestPatrimonyLevel3 {
  id                String                  @id @default(uuid()) @db.Uuid
  level2Id          String                  @db.Uuid
  code              String                  @db.VarChar(80)
  name              String                  @db.VarChar(255)
  type              PatrimonyLevel3Type
  totalAreaHa       Decimal                 @db.Decimal(12, 2)
  centroidLatitude  Decimal?                @db.Decimal(10, 7)
  centroidLongitude Decimal?                @db.Decimal(10, 7)
  lastInfoDate      DateTime?
  isActive          Boolean                 @default(true)
  createdAt         DateTime                @default(now())
  updatedAt         DateTime                @updatedAt
  level2            ForestPatrimonyLevel2   @relation(fields: [level2Id], references: [id], onDelete: Restrict)
  level4Units       ForestPatrimonyLevel4[]

  @@unique([level2Id, code])
}

model ForestPatrimonyLevel4 {
  id                String                        @id @default(uuid()) @db.Uuid
  level3Id          String                        @db.Uuid
  code              String                        @db.VarChar(80)
  name              String                        @db.VarChar(255)
  type              PatrimonyLevel4Type
  totalAreaHa       Decimal                       @db.Decimal(12, 2)
  plantableAreaHa   Decimal?                      @db.Decimal(12, 2)
  rotationPhase     String?                       @db.VarChar(120)
  previousUse       String?                       @db.VarChar(255)
  centroidLatitude  Decimal?                      @db.Decimal(10, 7)
  centroidLongitude Decimal?                      @db.Decimal(10, 7)
  lastInfoDate      DateTime?
  isActive          Boolean                       @default(true)
  createdAt         DateTime                      @default(now())
  updatedAt         DateTime                      @updatedAt
  level3            ForestPatrimonyLevel3         @relation(fields: [level3Id], references: [id], onDelete: Restrict)
  level5Units       ForestPatrimonyLevel5[]
  level6Assets      ForestBiologicalAssetLevel6[]
  level4Costs       Level4AdministrativeCost[]

  @@unique([level3Id, code])
}

model ForestPatrimonyLevel5 {
  id                String                @id @default(uuid()) @db.Uuid
  level4Id          String                @db.Uuid
  code              String                @db.VarChar(80)
  name              String                @db.VarChar(255)
  type              PatrimonyLevel5Type
  shapeType         PlotShapeType
  dimension1M       Decimal?              @db.Decimal(12, 4)
  dimension2M       Decimal?              @db.Decimal(12, 4)
  dimension3M       Decimal?              @db.Decimal(12, 4)
  dimension4M       Decimal?              @db.Decimal(12, 4)
  areaM2            Decimal               @db.Decimal(12, 4)
  centroidLatitude  Decimal?              @db.Decimal(10, 7)
  centroidLongitude Decimal?              @db.Decimal(10, 7)
  lastInfoDate      DateTime?
  isActive          Boolean               @default(true)
  createdAt         DateTime              @default(now())
  updatedAt         DateTime              @updatedAt
  level4            ForestPatrimonyLevel4 @relation(fields: [level4Id], references: [id], onDelete: Restrict)

  @@unique([level4Id, code])
}

model ForestBiologicalAssetLevel6 {
  id                            String                @id @default(uuid()) @db.Uuid
  level4Id                      String                @map("level4_id") @db.Uuid
  biologicalAssetKey            String                @unique(map: "uq_forest_bio_asset_l6_biological_asset_key") @map("biological_asset_key") @db.VarChar(220)
  accountingKey                 String?               @map("accounting_key") @db.VarChar(220)
  establishmentDate             DateTime?             @map("establishment_date")
  plantingYear                  Int?                  @map("planting_year")
  geneticMaterialCode           String?               @map("genetic_material_code") @db.VarChar(80)
  geneticMaterialName           String?               @map("genetic_material_name") @db.VarChar(255)
  assetType                     BiologicalAssetType   @default(COMERCIAL) @map("asset_type")
  managementSchemeCode          String?               @map("management_scheme_code") @db.VarChar(80)
  managementSchemeName          String?               @map("management_scheme_name") @db.VarChar(255)
  inventoryCode                 String?               @map("inventory_code") @db.VarChar(80)
  inventoryType                 String?               @map("inventory_type") @db.VarChar(120)
  inventoryDate                 DateTime?             @map("inventory_date")
  inventoryAgeYears             Int?                  @map("inventory_age_years")
  level5UnitCount               Int?                  @map("level5_unit_count")
  spacingCode                   String?               @map("spacing_code") @db.VarChar(80)
  spacingDescription            String?               @map("spacing_description") @db.VarChar(255)
  spacingBetweenRowsM           Decimal?              @map("spacing_between_rows_m") @db.Decimal(12, 4)
  spacingBetweenTreesM          Decimal?              @map("spacing_between_trees_m") @db.Decimal(12, 4)
  treeDensityPerHa              Decimal?              @map("tree_density_per_ha") @db.Decimal(12, 0)
  survivalRate                  Decimal?              @map("survival_rate") @db.Decimal(5, 2)
  dominantHeightM               Decimal?              @map("dominant_height_m") @db.Decimal(12, 4)
  meanHeightM                   Decimal?              @map("mean_height_m") @db.Decimal(12, 4)
  quadraticDiameterM            Decimal?              @map("quadratic_diameter_m") @db.Decimal(12, 4)
  basalAreaM2                   Decimal?              @map("basal_area_m2") @db.Decimal(12, 4)
  unitVolumeM3NoBarkPerHa       Decimal?              @map("unit_volume_m3_no_bark_per_ha") @db.Decimal(12, 4)
  unitVolumeM3WithBarkPerHa     Decimal?              @map("unit_volume_m3_with_bark_per_ha") @db.Decimal(12, 4)
  totalVolumeM3NoBark           Decimal?              @map("total_volume_m3_no_bark") @db.Decimal(12, 4)
  totalVolumeM3WithBark         Decimal?              @map("total_volume_m3_with_bark") @db.Decimal(12, 4)
  adjustedVolumeM3NoBarkPerHa   Decimal?              @map("adjusted_volume_m3_no_bark_per_ha") @db.Decimal(12, 4)
  adjustedVolumeM3WithBarkPerHa Decimal?              @map("adjusted_volume_m3_with_bark_per_ha") @db.Decimal(12, 4)
  imaClassCode                  String?               @map("ima_class_code") @db.VarChar(80)
  imaClassName                  String?               @map("ima_class_name") @db.VarChar(120)
  actualCostUsd                 Decimal?              @map("actual_cost_usd") @db.Decimal(18, 2)
  isActive                      Boolean               @default(true) @map("is_active")
  createdAt                     DateTime              @default(now()) @map("created_at")
  updatedAt                     DateTime              @updatedAt @map("updated_at")
  level4                        ForestPatrimonyLevel4 @relation(fields: [level4Id], references: [id], onDelete: Restrict, map: "fk_forest_bio_asset_l6_level4")

  @@index([level4Id, createdAt], map: "idx_forest_bio_asset_l6_level4_created_at")
  @@map("forest_biological_asset_level6")
}

model ManagementScheme {
  id             String        @id @default(uuid()) @db.Uuid
  code           String        @db.VarChar(80)
  name           String        @db.VarChar(255)
  isActive       Boolean       @default(true)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  organizationId String?       @db.Uuid
  organization   Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([organizationId, code])
}

model ForestInventoryTypeCatalog {
  id             String        @id @default(uuid()) @db.Uuid
  code           String        @db.VarChar(80)
  name           String        @db.VarChar(255)
  isActive       Boolean       @default(true)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  organizationId String?       @db.Uuid
  organization   Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([organizationId, code])
}

model ImaClass {
  id             String            @id @default(uuid()) @db.Uuid
  code           String            @db.VarChar(80)
  classification ImaClassification
  name           String            @db.VarChar(120)
  description    String?
  rangeMin       Decimal?          @db.Decimal(12, 4)
  rangeMax       Decimal?          @db.Decimal(12, 4)
  isActive       Boolean           @default(true)
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  organizationId String?           @db.Uuid
  organization   Organization?     @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([organizationId, code])
}

model Continent {
  id           String        @id @default(uuid()) @db.Uuid
  code         String        @unique @db.VarChar(20)
  name         String        @db.VarChar(120)
  isActive     Boolean       @default(true)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  countries    Country[]
  landUseTypes LandUseType[]
}

model Country {
  id            String            @id @default(uuid()) @db.Uuid
  continentId   String            @db.Uuid
  code          String            @db.VarChar(20)
  name          String            @db.VarChar(120)
  flagUrl       String?           @db.VarChar(500)
  isActive      Boolean           @default(true)
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  continent     Continent         @relation(fields: [continentId], references: [id], onDelete: Restrict)
  regions       Region[]
  states        StateDepartment[]
  provenances   Provenance[]
  organizations Organization[]

  @@unique([continentId, code])
}

model Region {
  id        String   @id @default(uuid()) @db.Uuid
  countryId String   @db.Uuid
  code      String   @db.VarChar(20)
  name      String   @db.VarChar(120)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  country   Country  @relation(fields: [countryId], references: [id], onDelete: Restrict)

  @@unique([countryId, code])
}

model StateDepartment {
  id             String                 @id @default(uuid()) @db.Uuid
  countryId      String                 @db.Uuid
  code           String                 @db.VarChar(20)
  name           String                 @db.VarChar(120)
  isActive       Boolean                @default(true)
  createdAt      DateTime               @default(now())
  updatedAt      DateTime               @updatedAt
  country        Country                @relation(fields: [countryId], references: [id], onDelete: Restrict)
  municipalities MunicipalityDistrict[]

  @@unique([countryId, code])
}

model MunicipalityDistrict {
  id        String          @id @default(uuid()) @db.Uuid
  stateId   String          @db.Uuid
  code      String          @db.VarChar(20)
  name      String          @db.VarChar(120)
  isActive  Boolean         @default(true)
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt
  state     StateDepartment @relation(fields: [stateId], references: [id], onDelete: Restrict)
  cities    City[]

  @@unique([stateId, code])
}

model City {
  id             String               @id @default(uuid()) @db.Uuid
  municipalityId String               @db.Uuid
  code           String               @db.VarChar(20)
  name           String               @db.VarChar(120)
  isActive       Boolean              @default(true)
  createdAt      DateTime             @default(now())
  updatedAt      DateTime             @updatedAt
  municipality   MunicipalityDistrict @relation(fields: [municipalityId], references: [id], onDelete: Restrict)
  communities    CommunityTerritory[]

  @@unique([municipalityId, code])
}

model CommunityTerritory {
  id        String        @id @default(uuid()) @db.Uuid
  cityId    String        @db.Uuid
  code      String        @db.VarChar(20)
  name      String        @db.VarChar(150)
  type      CommunityType
  isActive  Boolean       @default(true)
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  city      City          @relation(fields: [cityId], references: [id], onDelete: Restrict)

  @@unique([cityId, code])
}

model Species {
  id               String            @id @default(uuid()) @db.Uuid
  code             String            @db.VarChar(80)
  scientificName   String            @db.VarChar(255)
  commonName       String?           @db.VarChar(255)
  genus            String?           @db.VarChar(120)
  family           String?           @db.VarChar(120)
  taxonomicOrder   String?           @db.VarChar(120)
  isActive         Boolean           @default(true)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  vegetalMaterials VegetalMaterial[]
  organizationId   String?           @db.Uuid
  organization     Organization?     @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([organizationId, code])
}

model Provenance {
  id               String            @id @default(uuid()) @db.Uuid
  countryId        String            @db.Uuid
  code             String            @db.VarChar(80)
  name             String            @db.VarChar(150)
  isActive         Boolean           @default(true)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  country          Country           @relation(fields: [countryId], references: [id], onDelete: Restrict)
  vegetalMaterials VegetalMaterial[]
  organizationId   String?           @db.Uuid
  organization     Organization?     @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([countryId, code])
  @@unique([organizationId, code])
}

model VegetalMaterial {
  id             String              @id @default(uuid()) @db.Uuid
  code           String              @db.VarChar(80)
  name           String              @db.VarChar(255)
  speciesId      String              @db.Uuid
  materialType   VegetalMaterialType
  plantType      PlantType
  plantOrigin    PlantOrigin
  provenanceId   String?             @db.Uuid
  isActive       Boolean             @default(true)
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
  species        Species             @relation(fields: [speciesId], references: [id], onDelete: Restrict)
  provenance     Provenance?         @relation(fields: [provenanceId], references: [id], onDelete: SetNull)
  organizationId String?             @db.Uuid
  organization   Organization?       @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([organizationId, code])
}

model LandUseType {
  id             String        @id @default(uuid()) @db.Uuid
  continentId    String?       @db.Uuid
  code           String        @db.VarChar(80)
  name           String        @db.VarChar(150)
  isProductive   Boolean       @default(false)
  isActive       Boolean       @default(true)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  continent      Continent?    @relation(fields: [continentId], references: [id], onDelete: SetNull)
  organizationId String?       @db.Uuid
  organization   Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([organizationId, code])
}

model Spacing {
  id               String        @id @default(uuid()) @db.Uuid
  code             String        @db.VarChar(80)
  name             String        @db.VarChar(150)
  description      String?       @db.VarChar(255)
  betweenRowsM     Decimal?      @db.Decimal(12, 4)
  betweenTreesM    Decimal?      @db.Decimal(12, 4)
  treeDensityPerHa Decimal?      @db.Decimal(12, 0)
  isActive         Boolean       @default(true)
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  organizationId   String?       @db.Uuid
  organization     Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([organizationId, code])
}

model PlantationDirection {
  id        String   @id @default(uuid()) @db.Uuid
  code      String   @unique @db.VarChar(80)
  name      String   @db.VarChar(150)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model AccountingDocument {
  id                String                     @id @default(uuid()) @db.Uuid
  code              String                     @unique @db.VarChar(80)
  documentNumber    String                     @db.VarChar(80)
  documentDate      DateTime
  description       String?
  bookValueUsd      Decimal                    @db.Decimal(18, 2)
  bookValuePerHaUsd Decimal?                   @db.Decimal(18, 2)
  isActive          Boolean                    @default(true)
  createdAt         DateTime                   @default(now())
  updatedAt         DateTime                   @updatedAt
  level4Costs       Level4AdministrativeCost[]
}

model Level4AdministrativeCost {
  id                   String                @id @default(uuid()) @db.Uuid
  level4Id             String                @db.Uuid
  code                 String                @db.VarChar(80)
  plantationAreaHa     Decimal               @db.Decimal(12, 2)
  rotationPhase        String?               @db.VarChar(120)
  accountingDocumentId String?               @db.Uuid
  isActive             Boolean               @default(true)
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  level4               ForestPatrimonyLevel4 @relation(fields: [level4Id], references: [id], onDelete: Restrict)
  accountingDocument   AccountingDocument?   @relation(fields: [accountingDocumentId], references: [id], onDelete: SetNull)

  @@unique([level4Id, code])
}

model ProductType {
  id                     String                 @id @default(uuid()) @db.Uuid
  code                   String                 @db.VarChar(80)
  name                   String                 @db.VarChar(150)
  minLengthM             Decimal?               @db.Decimal(12, 4)
  maxLengthM             Decimal?               @db.Decimal(12, 4)
  minSmallEndDiameterCm  Decimal?               @db.Decimal(12, 4)
  maxSmallEndDiameterCm  Decimal?               @db.Decimal(12, 4)
  recommendedHarvestType RecommendedHarvestType
  isActive               Boolean                @default(true)
  createdAt              DateTime               @default(now())
  updatedAt              DateTime               @updatedAt
  organizationId         String?                @db.Uuid
  organization           Organization?          @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([organizationId, code])
}
